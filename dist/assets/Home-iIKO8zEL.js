import{o as v,c as h,a as t,t as g,n as V,b as R,w as M,d as f,F as D,r as T,e as $,f as z,g as H,v as j,h as w,u as L,i as Y,j as b,k as F,l as N,m as q,p as G,q as A}from"./index-DaMFx6Uy.js";import{_ as C,u as J}from"./_plugin-vue_export-helper-S13fuE6F.js";function B(){const s=new Date,l=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),e=String(s.getDate()).padStart(2,"0");return`${l}-${a}-${e}`}function E(s){const l=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),e=String(s.getDate()).padStart(2,"0");return`${l}-${a}-${e}`}function O(s){const l=B();return s.records&&s.records[l]===!0}function U(s){const l=s.records||{},a=new Date;a.setHours(0,0,0,0);let e=0,n=new Date(a);for(;;){const c=E(n);if(l[c]===!0)e++,n.setDate(n.getDate()-1);else break}return e}function K(s,l=365){const a=s.records||{},e=new Date;e.setHours(0,0,0,0);const n=[];for(let c=l-1;c>=0;c--){const d=new Date(e);d.setDate(d.getDate()-c);const m=E(d);n.push({date:m,completed:a[m]===!0})}return n}function P(s){const l=s.filter(d=>!d.archived);B();const a=l.filter(d=>O(d)).length,e=l.length,n=e>0?Math.round(a/e*100):0,c=l.length>0?Math.max(...l.map(d=>U(d))):0;return{todayCompleted:a,todayTotal:e,todayRate:n,longestStreak:c}}const Q={class:"stats-bar"},W={class:"stat-item"},X={class:"stat-value"},Z={class:"stat-item"},tt={class:"stat-value"},et={class:"stat-item"},st={class:"stat-value"},at={__name:"StatsBar",props:{stats:{type:Object,required:!0}},setup(s){return(l,a)=>(v(),h("div",Q,[t("div",W,[a[0]||(a[0]=t("span",{class:"stat-label"},"ä»Šæ—¥å®Œæˆ",-1)),t("span",X,g(s.stats.todayCompleted)+"/"+g(s.stats.todayTotal),1)]),t("div",Z,[a[1]||(a[1]=t("span",{class:"stat-label"},"æ€»å®Œæˆç‡",-1)),t("span",tt,g(s.stats.todayRate)+"%",1)]),t("div",et,[a[2]||(a[2]=t("span",{class:"stat-label"},"æœ€é•¿è¿ç»­",-1)),t("span",st,g(s.stats.longestStreak)+"å¤©",1)])]))}},ot=C(at,[["__scopeId","data-v-0c89f587"]]),it={class:"habit-header"},nt={class:"habit-info"},lt={class:"habit-details"},dt={class:"habit-name"},ct={class:"habit-streak"},rt={class:"checkbox-wrapper"},ut={class:"heatmap-preview"},vt={class:"heatmap-grid"},ht=["title"],mt={__name:"HabitCard",props:{habit:{type:Object,required:!0}},emits:["toggle","click"],setup(s,{emit:l}){const a=s,e=l,n=$(()=>O(a.habit)),c=$(()=>U(a.habit)),d=$(()=>K(a.habit,56)),m=()=>{e("toggle",a.habit.id)},r=()=>{e("click",a.habit.id)};return(y,k)=>(v(),h("div",{class:f(["habit-card",{completed:n.value}]),style:V({"--habit-color":s.habit.color}),onClick:r},[t("div",it,[t("div",nt,[t("div",{class:"habit-emoji",style:V({background:`${s.habit.color}20`,color:s.habit.color})},g(s.habit.emoji||"ğŸ“"),5),t("div",lt,[t("div",dt,g(s.habit.name),1),t("div",ct,[k[0]||(k[0]=R(" è¿ç»­ ",-1)),t("strong",null,g(c.value),1),k[1]||(k[1]=R(" å¤© ",-1))])])]),t("div",rt,[t("div",{class:f(["habit-checkbox",{checked:n.value}]),onClick:M(m,["stop"])},null,2)])]),t("div",ut,[k[2]||(k[2]=t("div",{class:"heatmap-preview-title"},"æœ€è¿‘8å‘¨",-1)),t("div",vt,[(v(!0),h(D,null,T(d.value,(_,x)=>(v(),h("div",{key:x,class:f(["heatmap-day",{completed:_.completed}]),title:`${_.date}: ${_.completed?"å·²å®Œæˆ":"æœªå®Œæˆ"}`},null,10,ht))),128))])])],6))}},I=C(mt,[["__scopeId","data-v-a8399d90"]]),pt={class:"modal-content"},bt={class:"modal-header"},gt={class:"form-group"},yt={class:"form-group"},kt={class:"form-group"},_t={class:"color-picker"},ft={class:"form-actions"},$t={type:"submit",class:"btn btn-primary"},wt={__name:"HabitModal",props:{show:Boolean,editingHabit:Object},emits:["close","submit"],setup(s,{emit:l}){const a=s,e=l,n=w({name:"",emoji:"ğŸ“",color:"#10b981"});z(()=>a.editingHabit,m=>{m?n.value={name:m.name,emoji:m.emoji||"ğŸ“",color:m.color||"#10b981"}:n.value={name:"",emoji:"ğŸ“",color:"#10b981"}},{immediate:!0});const c=()=>{e("close")},d=()=>{e("submit",{...n.value}),c()};return(m,r)=>(v(),h("div",{class:f(["modal",{active:s.show}]),onClick:M(c,["self"])},[t("div",pt,[t("div",bt,[t("h2",null,g(s.editingHabit?"ç¼–è¾‘ä¹ æƒ¯":"æ·»åŠ æ–°ä¹ æƒ¯"),1),t("button",{class:"modal-close",onClick:c},"Ã—")]),t("form",{onSubmit:M(d,["prevent"])},[t("div",gt,[r[3]||(r[3]=t("label",{for:"habit-name"},"ä¹ æƒ¯åç§°",-1)),H(t("input",{type:"text",id:"habit-name","onUpdate:modelValue":r[0]||(r[0]=y=>n.value.name=y),required:"",autofocus:"",placeholder:"ä¾‹å¦‚ï¼šæ¯å¤©è·‘æ­¥"},null,512),[[j,n.value.name]])]),t("div",yt,[r[4]||(r[4]=t("label",{for:"habit-emoji"},"Emoji å›¾æ ‡",-1)),H(t("input",{type:"text",id:"habit-emoji","onUpdate:modelValue":r[1]||(r[1]=y=>n.value.emoji=y),maxlength:"2",placeholder:"ğŸ“"},null,512),[[j,n.value.emoji]])]),t("div",kt,[r[5]||(r[5]=t("label",{for:"habit-color"},"é¢œè‰²",-1)),t("div",_t,[H(t("input",{id:"habit-color",type:"color","onUpdate:modelValue":r[2]||(r[2]=y=>n.value.color=y)},null,512),[[j,n.value.color]])])]),t("div",ft,[t("button",$t,g(s.editingHabit?"ä¿å­˜":"æ·»åŠ "),1),t("button",{type:"button",class:"btn btn-secondary",onClick:c},"å–æ¶ˆ")])],32)])],2))}},Ct=C(wt,[["__scopeId","data-v-a376ecd6"]]),xt={class:"container"},St={class:"user-bar"},Ht={class:"user-info"},jt={class:"header"},Mt={class:"section-block"},Dt={key:0,class:"habits-container"},Tt={key:1,class:"habits-container"},Bt={key:2,class:"habits-container"},Vt={class:"section-header"},Rt={class:"section-actions"},Ft={class:"section-subtitle"},Nt={key:0,class:"habits-container archived-habits"},qt={__name:"Home",setup(s){const l=G(),a=L(),e=J(),n=w(!1),c=w(!1),d=w(null),m=$(()=>P(e.habits));Y(async()=>{var p,o;try{await e.loadHabits()}catch(u){const i=(u==null?void 0:u.message)||((o=(p=u==null?void 0:u.response)==null?void 0:p.data)==null?void 0:o.message)||"åŠ è½½ä¹ æƒ¯å¤±è´¥";console.error("åŠ è½½ä¹ æƒ¯å¤±è´¥:",i,u)}});const r=async p=>{var o,u;try{await e.toggleHabit(p,B())}catch(i){const S=(i==null?void 0:i.message)||((u=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:u.message)||"åˆ‡æ¢æ‰“å¡çŠ¶æ€å¤±è´¥";console.error("åˆ‡æ¢æ‰“å¡çŠ¶æ€å¤±è´¥:",S,i)}},y=p=>{d.value=e.habits.find(o=>o.id===p),c.value=!0},k=()=>{n.value=!1,c.value=!1,d.value=null},_=async p=>{var o,u;try{d.value?await e.updateHabit(d.value.id,p):await e.addHabit(p.name,p.emoji,p.color),k()}catch(i){const S=(i==null?void 0:i.message)||((u=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:u.message)||"ä¿å­˜ä¹ æƒ¯å¤±è´¥";console.error("ä¿å­˜ä¹ æƒ¯å¤±è´¥:",S,i)}},x=async()=>{await a.logout(),l.push("/login")};return(p,o)=>{var u;return v(),h("div",xt,[t("div",St,[t("span",Ht," ğŸ‘¤ æ¬¢è¿ï¼Œ"+g(((u=b(a).user)==null?void 0:u.username)||"æœªç™»å½•"),1),t("button",{class:"logout-btn",onClick:x,title:"ç™»å‡º"},[...o[2]||(o[2]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),t("polyline",{points:"16 17 21 12 16 7"}),t("line",{x1:"21",y1:"12",x2:"9",y2:"12"})],-1)])])]),t("header",jt,[o[3]||(o[3]=F('<h1 data-v-5da40e50>ä¹ æƒ¯è¿½è¸ªå™¨</h1><div class="app-intro" data-v-5da40e50><p class="app-intro-text" data-v-5da40e50>ä¸€ä¸ªä¸“æ³¨æ‰“å¡å’Œçœ‹åˆ°è¿›æ­¥çš„æç®€ä¹ æƒ¯è®°å½•å·¥å…·ã€‚</p><div class="app-tags" data-v-5da40e50><span class="app-tag" data-v-5da40e50>ğŸ“… æ¯æ—¥æ‰“å¡</span><span class="app-tag" data-v-5da40e50>ğŸ“ˆ è¿ç»­å¤©æ•°</span><span class="app-tag" data-v-5da40e50>ğŸ”¥ 30 å¤©çƒ­åŠ›å›¾</span><span class="app-tag" data-v-5da40e50>â˜ï¸ äº‘ç«¯å­˜å‚¨ Â· æ•°æ®å®‰å…¨</span></div></div>',2)),N(ot,{stats:m.value},null,8,["stats"])]),t("main",null,[t("section",Mt,[o[6]||(o[6]=t("div",{class:"section-header"},[t("h2",{class:"section-title"},"æ­£åœ¨è¿›è¡Œçš„ä¹ æƒ¯")],-1)),b(e).loading?(v(),h("div",Dt,[...o[4]||(o[4]=[t("div",{class:"loading"},"åŠ è½½ä¸­...",-1)])])):b(e).activeHabits.length===0?(v(),h("div",Tt,[...o[5]||(o[5]=[F('<div class="empty-state" data-v-5da40e50><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-5da40e50><circle cx="12" cy="12" r="10" data-v-5da40e50></circle><line x1="12" y1="8" x2="12" y2="12" data-v-5da40e50></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-5da40e50></line></svg><h3 data-v-5da40e50>è¿˜æ²¡æœ‰ä¹ æƒ¯</h3><p data-v-5da40e50>ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä¹ æƒ¯</p></div>',1)])])):(v(),h("div",Bt,[(v(!0),h(D,null,T(b(e).activeHabits,i=>(v(),A(I,{key:i.id,habit:i,onToggle:r,onClick:y},null,8,["habit"]))),128))]))]),b(e).archivedHabits.length>0?(v(),h("section",{key:0,class:f(["section-block archived-section",{collapsed:b(e).archivedCollapsed}])},[t("div",Vt,[o[7]||(o[7]=t("h2",{class:"section-title"},"å·²å½’æ¡£çš„ä¹ æƒ¯",-1)),t("div",Rt,[t("span",Ft,g(b(e).archivedHabits.length)+" ä¸ª",1),t("button",{class:"section-toggle-btn",onClick:o[0]||(o[0]=(...i)=>b(e).toggleArchivedCollapsed&&b(e).toggleArchivedCollapsed(...i))},g(b(e).archivedCollapsed?"å±•å¼€":"æ”¶èµ·"),1)])]),b(e).archivedCollapsed?q("",!0):(v(),h("div",Nt,[(v(!0),h(D,null,T(b(e).archivedHabits,i=>(v(),A(I,{key:i.id,habit:i,onToggle:r,onClick:y},null,8,["habit"]))),128))]))],2)):q("",!0)]),t("button",{class:"fab",onClick:o[1]||(o[1]=i=>n.value=!0),title:"æ·»åŠ æ–°ä¹ æƒ¯"},[...o[8]||(o[8]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])]),N(Ct,{show:n.value||c.value,"editing-habit":d.value,onClose:k,onSubmit:_},null,8,["show","editing-habit"])])}}},Et=C(qt,[["__scopeId","data-v-5da40e50"]]);export{Et as default};
