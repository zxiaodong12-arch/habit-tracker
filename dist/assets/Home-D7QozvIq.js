import{o as h,c as m,a as t,t as p,n as A,b as R,w as j,d as _,F as D,r as T,e as $,f as L,g as S,v as M,h as B,i as w,u as Y,j as G,k as g,l as F,m as N,p as J,q}from"./index-DYgZeeKL.js";import{_ as C,u as K}from"./_plugin-vue_export-helper-BRaeSakf.js";function V(){const e=new Date,d=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${d}-${o}-${a}`}function E(e){const d=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${d}-${o}-${a}`}function O(e){const d=V();return e.records&&e.records[d]===!0}function U(e){const d=e.records||{},o=new Date;o.setHours(0,0,0,0);let a=0,n=new Date(o);for(;;){const r=E(n);if(d[r]===!0)a++,n.setDate(n.getDate()-1);else break}return a}function P(e,d=365){const o=e.records||{},a=new Date;a.setHours(0,0,0,0);const n=[];for(let r=d-1;r>=0;r--){const c=new Date(a);c.setDate(c.getDate()-r);const y=E(c);n.push({date:y,completed:o[y]===!0})}return n}function Q(e){const d=e.filter(c=>!c.archived);V();const o=d.filter(c=>O(c)).length,a=d.length,n=a>0?Math.round(o/a*100):0,r=d.length>0?Math.max(...d.map(c=>U(c))):0;return{todayCompleted:o,todayTotal:a,todayRate:n,longestStreak:r}}const W={class:"stats-bar"},X={class:"stat-item"},Z={class:"stat-value"},tt={class:"stat-item"},at={class:"stat-value"},et={class:"stat-item"},st={class:"stat-value"},ot={__name:"StatsBar",props:{stats:{type:Object,required:!0}},setup(e){return(d,o)=>(h(),m("div",W,[t("div",X,[o[0]||(o[0]=t("span",{class:"stat-label"},"ä»Šæ—¥å®Œæˆ",-1)),t("span",Z,p(e.stats.todayCompleted)+"/"+p(e.stats.todayTotal),1)]),t("div",tt,[o[1]||(o[1]=t("span",{class:"stat-label"},"æ€»å®Œæˆç‡",-1)),t("span",at,p(e.stats.todayRate)+"%",1)]),t("div",et,[o[2]||(o[2]=t("span",{class:"stat-label"},"æœ€é•¿è¿ç»­",-1)),t("span",st,p(e.stats.longestStreak)+"å¤©",1)])]))}},it=C(ot,[["__scopeId","data-v-0c89f587"]]),nt={class:"habit-header"},lt={class:"habit-info"},dt={class:"habit-details"},ct={class:"habit-name"},rt={class:"habit-streak"},ut={class:"checkbox-wrapper"},vt={class:"heatmap-preview"},ht={class:"heatmap-grid"},bt=["title"],mt={__name:"HabitCard",props:{habit:{type:Object,required:!0}},emits:["toggle","click"],setup(e,{emit:d}){const o=e,a=d,n=$(()=>O(o.habit)),r=$(()=>U(o.habit)),c=$(()=>P(o.habit,30)),y=()=>{a("toggle",o.habit.id)},f=()=>{a("click",o.habit.id)};return(u,v)=>(h(),m("div",{class:_(["habit-card",{completed:n.value}]),style:A({"--habit-color":e.habit.color}),onClick:f},[t("div",nt,[t("div",lt,[t("div",{class:"habit-emoji",style:A({background:`${e.habit.color}20`,color:e.habit.color})},p(e.habit.emoji||"ğŸ“"),5),t("div",dt,[t("div",ct,p(e.habit.name),1),t("div",rt,[v[0]||(v[0]=R(" è¿ç»­ ",-1)),t("strong",null,p(r.value),1),v[1]||(v[1]=R(" å¤© ",-1))])])]),t("div",ut,[t("div",{class:_(["habit-checkbox",{checked:n.value}]),onClick:j(y,["stop"])},null,2)])]),t("div",vt,[v[2]||(v[2]=t("div",{class:"heatmap-preview-title"},"æœ€è¿‘30å¤©",-1)),t("div",ht,[(h(!0),m(D,null,T(c.value,(k,H)=>(h(),m("div",{key:H,class:_(["heatmap-day",{completed:k.completed}]),title:`${k.date}: ${k.completed?"å·²å®Œæˆ":"æœªå®Œæˆ"}`},null,10,bt))),128))])])],6))}},I=C(mt,[["__scopeId","data-v-47063c08"]]),pt={class:"modal-content"},gt={class:"modal-header"},ft={class:"form-group"},yt={class:"form-group"},kt={class:"form-group"},_t={class:"color-picker"},$t={class:"form-actions"},wt={type:"submit",class:"btn btn-primary"},Ct={__name:"HabitModal",props:{show:Boolean,editingHabit:Object},emits:["close","submit","archive"],setup(e,{emit:d}){const o=e,a=d,n=w({name:"",emoji:"ğŸ“",color:"#10b981"});L(()=>o.editingHabit,f=>{f?n.value={name:f.name,emoji:f.emoji||"ğŸ“",color:f.color||"#10b981"}:n.value={name:"",emoji:"ğŸ“",color:"#10b981"}},{immediate:!0});const r=()=>{a("close")},c=()=>{a("submit",{...n.value}),r()},y=()=>{a("archive")};return(f,u)=>(h(),m("div",{class:_(["modal",{active:e.show}]),onClick:j(r,["self"])},[t("div",pt,[t("div",gt,[t("h2",null,p(e.editingHabit?"ç¼–è¾‘ä¹ æƒ¯":"æ·»åŠ æ–°ä¹ æƒ¯"),1),t("button",{class:"modal-close",onClick:r},"Ã—")]),t("form",{onSubmit:j(c,["prevent"])},[t("div",ft,[u[3]||(u[3]=t("label",{for:"habit-name"},"ä¹ æƒ¯åç§°",-1)),S(t("input",{type:"text",id:"habit-name","onUpdate:modelValue":u[0]||(u[0]=v=>n.value.name=v),required:"",autofocus:"",placeholder:"ä¾‹å¦‚ï¼šæ¯å¤©è·‘æ­¥"},null,512),[[M,n.value.name]])]),t("div",yt,[u[4]||(u[4]=t("label",{for:"habit-emoji"},"Emoji å›¾æ ‡",-1)),S(t("input",{type:"text",id:"habit-emoji","onUpdate:modelValue":u[1]||(u[1]=v=>n.value.emoji=v),maxlength:"2",placeholder:"ğŸ“"},null,512),[[M,n.value.emoji]])]),t("div",kt,[u[5]||(u[5]=t("label",{for:"habit-color"},"é¢œè‰²",-1)),t("div",_t,[S(t("input",{id:"habit-color",type:"color","onUpdate:modelValue":u[2]||(u[2]=v=>n.value.color=v)},null,512),[[M,n.value.color]])])]),t("div",$t,[t("button",wt,p(e.editingHabit?"ä¿å­˜":"æ·»åŠ "),1),e.editingHabit?(h(),m("button",{key:0,type:"button",class:"btn btn-secondary",onClick:y},p(e.editingHabit.archived?"å–æ¶ˆå½’æ¡£":"å½’æ¡£"),1)):B("",!0),t("button",{type:"button",class:"btn btn-secondary",onClick:r},"å–æ¶ˆ")])],32)])],2))}},Ht=C(Ct,[["__scopeId","data-v-77f6e2b5"]]),xt={class:"container"},St={class:"user-bar"},Mt={class:"user-info"},jt={class:"header"},Dt={class:"section-block"},Tt={key:0,class:"habits-container"},Bt={key:1,class:"habits-container"},Vt={key:2,class:"habits-container"},At={class:"section-header"},Rt={class:"section-actions"},Ft={class:"section-subtitle"},Nt={key:0,class:"habits-container archived-habits"},qt={__name:"Home",setup(e){const d=J(),o=Y(),a=K(),n=w(!1),r=w(!1),c=w(null),y=$(()=>Q(a.habits));G(async()=>{var b,s;try{await a.loadHabits()}catch(l){const i=(l==null?void 0:l.message)||((s=(b=l==null?void 0:l.response)==null?void 0:b.data)==null?void 0:s.message)||"åŠ è½½ä¹ æƒ¯å¤±è´¥";console.error("åŠ è½½ä¹ æƒ¯å¤±è´¥:",i,l)}});const f=async b=>{var s,l;try{await a.toggleHabit(b,V())}catch(i){const x=(i==null?void 0:i.message)||((l=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:l.message)||"åˆ‡æ¢æ‰“å¡çŠ¶æ€å¤±è´¥";console.error("åˆ‡æ¢æ‰“å¡çŠ¶æ€å¤±è´¥:",x,i)}},u=b=>{c.value=a.habits.find(s=>s.id===b),r.value=!0},v=()=>{n.value=!1,r.value=!1,c.value=null},k=async b=>{var s,l;try{c.value?await a.updateHabit(c.value.id,b):await a.addHabit(b.name,b.emoji,b.color),v()}catch(i){const x=(i==null?void 0:i.message)||((l=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:l.message)||"ä¿å­˜ä¹ æƒ¯å¤±è´¥";console.error("ä¿å­˜ä¹ æƒ¯å¤±è´¥:",x,i)}},H=async()=>{var b,s;if(c.value)try{await a.toggleArchiveHabit(c.value.id),v()}catch(l){const i=(l==null?void 0:l.message)||((s=(b=l==null?void 0:l.response)==null?void 0:b.data)==null?void 0:s.message)||"å½’æ¡£æ“ä½œå¤±è´¥";console.error("å½’æ¡£æ“ä½œå¤±è´¥:",i,l)}},z=async()=>{await o.logout(),d.push("/login")};return(b,s)=>{var l;return h(),m("div",xt,[t("div",St,[t("span",Mt," ğŸ‘¤ æ¬¢è¿ï¼Œ"+p(((l=g(o).user)==null?void 0:l.username)||"æœªç™»å½•"),1),t("button",{class:"logout-btn",onClick:z,title:"ç™»å‡º"},[...s[2]||(s[2]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),t("polyline",{points:"16 17 21 12 16 7"}),t("line",{x1:"21",y1:"12",x2:"9",y2:"12"})],-1)])])]),t("header",jt,[s[3]||(s[3]=F('<h1 data-v-aaffbad7>ä¹ æƒ¯è¿½è¸ªå™¨</h1><div class="app-intro" data-v-aaffbad7><p class="app-intro-text" data-v-aaffbad7>ä¸€ä¸ªä¸“æ³¨æ‰“å¡å’Œçœ‹åˆ°è¿›æ­¥çš„æç®€ä¹ æƒ¯è®°å½•å·¥å…·ã€‚</p><div class="app-tags" data-v-aaffbad7><span class="app-tag" data-v-aaffbad7>ğŸ“… æ¯æ—¥æ‰“å¡</span><span class="app-tag" data-v-aaffbad7>ğŸ“ˆ è¿ç»­å¤©æ•°</span><span class="app-tag" data-v-aaffbad7>ğŸ”¥ 30 å¤©çƒ­åŠ›å›¾</span><span class="app-tag" data-v-aaffbad7>â˜ï¸ äº‘ç«¯å­˜å‚¨ Â· æ•°æ®å®‰å…¨</span></div></div>',2)),N(it,{stats:y.value},null,8,["stats"])]),t("main",null,[t("section",Dt,[s[6]||(s[6]=t("div",{class:"section-header"},[t("h2",{class:"section-title"},"æ­£åœ¨è¿›è¡Œçš„ä¹ æƒ¯")],-1)),g(a).loading?(h(),m("div",Tt,[...s[4]||(s[4]=[t("div",{class:"loading"},"åŠ è½½ä¸­...",-1)])])):g(a).activeHabits.length===0?(h(),m("div",Bt,[...s[5]||(s[5]=[F('<div class="empty-state" data-v-aaffbad7><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-aaffbad7><circle cx="12" cy="12" r="10" data-v-aaffbad7></circle><line x1="12" y1="8" x2="12" y2="12" data-v-aaffbad7></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-aaffbad7></line></svg><h3 data-v-aaffbad7>è¿˜æ²¡æœ‰ä¹ æƒ¯</h3><p data-v-aaffbad7>ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä¹ æƒ¯</p></div>',1)])])):(h(),m("div",Vt,[(h(!0),m(D,null,T(g(a).activeHabits,i=>(h(),q(I,{key:i.id,habit:i,onToggle:f,onClick:u},null,8,["habit"]))),128))]))]),g(a).archivedHabits.length>0?(h(),m("section",{key:0,class:_(["section-block archived-section",{collapsed:g(a).archivedCollapsed}])},[t("div",At,[s[7]||(s[7]=t("h2",{class:"section-title"},"å·²å½’æ¡£çš„ä¹ æƒ¯",-1)),t("div",Rt,[t("span",Ft,p(g(a).archivedHabits.length)+" ä¸ª",1),t("button",{class:"section-toggle-btn",onClick:s[0]||(s[0]=(...i)=>g(a).toggleArchivedCollapsed&&g(a).toggleArchivedCollapsed(...i))},p(g(a).archivedCollapsed?"å±•å¼€":"æ”¶èµ·"),1)])]),g(a).archivedCollapsed?B("",!0):(h(),m("div",Nt,[(h(!0),m(D,null,T(g(a).archivedHabits,i=>(h(),q(I,{key:i.id,habit:i,onToggle:f,onClick:u},null,8,["habit"]))),128))]))],2)):B("",!0)]),t("button",{class:"fab",onClick:s[1]||(s[1]=i=>n.value=!0),title:"æ·»åŠ æ–°ä¹ æƒ¯"},[...s[8]||(s[8]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])]),N(Ht,{show:n.value||r.value,"editing-habit":c.value,onClose:v,onSubmit:k,onArchive:H},null,8,["show","editing-habit"])])}}},Ot=C(qt,[["__scopeId","data-v-aaffbad7"]]);export{Ot as default};
