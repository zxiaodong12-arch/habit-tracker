import{o as r,c as v,a as t,t as b,n as H,b as T,w as j,d as f,F as w,r as C,e as _,f as z,g as B,v as V,h as $,u as L,i as U,j as h,k as R,l as F,m as N,p as Y,q}from"./index-BDX3lOMN.js";import{_ as x,u as G}from"./_plugin-vue_export-helper-BEgLCHhX.js";function M(){const a=new Date,l=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),e=String(a.getDate()).padStart(2,"0");return`${l}-${s}-${e}`}function I(a){const l=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),e=String(a.getDate()).padStart(2,"0");return`${l}-${s}-${e}`}function E(a){const l=M();return a.records&&a.records[l]===!0}function O(a){const l=a.records||{},s=new Date;s.setHours(0,0,0,0);let e=0,c=new Date(s);for(;;){const i=I(c);if(l[i]===!0)e++,c.setDate(c.getDate()-1);else break}return e}function J(a,l=365){const s=a.records||{},e=new Date;e.setHours(0,0,0,0);const c=[];for(let i=l-1;i>=0;i--){const n=new Date(e);n.setDate(n.getDate()-i);const g=I(n);c.push({date:g,completed:s[g]===!0})}return c}function K(a){const l=a.filter(n=>!n.archived);M();const s=l.filter(n=>E(n)).length,e=l.length,c=e>0?Math.round(s/e*100):0,i=l.length>0?Math.max(...l.map(n=>O(n))):0;return{todayCompleted:s,todayTotal:e,todayRate:c,longestStreak:i}}const P={class:"stats-bar"},Q={class:"stat-item"},W={class:"stat-value"},X={class:"stat-item"},Z={class:"stat-value"},tt={class:"stat-item"},et={class:"stat-value"},at={__name:"StatsBar",props:{stats:{type:Object,required:!0}},setup(a){return(l,s)=>(r(),v("div",P,[t("div",Q,[s[0]||(s[0]=t("span",{class:"stat-label"},"ä»Šæ—¥å®Œæˆ",-1)),t("span",W,b(a.stats.todayCompleted)+"/"+b(a.stats.todayTotal),1)]),t("div",X,[s[1]||(s[1]=t("span",{class:"stat-label"},"æ€»å®Œæˆç‡",-1)),t("span",Z,b(a.stats.todayRate)+"%",1)]),t("div",tt,[s[2]||(s[2]=t("span",{class:"stat-label"},"æœ€é•¿è¿ç»­",-1)),t("span",et,b(a.stats.longestStreak)+"å¤©",1)])]))}},st=x(at,[["__scopeId","data-v-0c89f587"]]),ot={class:"habit-header"},it={class:"habit-info"},nt={class:"habit-details"},lt={class:"habit-name"},dt={class:"habit-streak"},ct={class:"checkbox-wrapper"},rt={class:"heatmap-preview"},ut={class:"heatmap-grid"},vt=["title"],ht={__name:"HabitCard",props:{habit:{type:Object,required:!0}},emits:["toggle","click"],setup(a,{emit:l}){const s=a,e=l,c=_(()=>E(s.habit)),i=_(()=>O(s.habit)),n=_(()=>J(s.habit,56)),g=()=>{e("toggle",s.habit.id)},p=()=>{e("click",s.habit.id)};return(u,d)=>(r(),v("div",{class:f(["habit-card",{completed:c.value}]),style:H({"--habit-color":a.habit.color}),onClick:p},[t("div",ot,[t("div",it,[t("div",{class:"habit-emoji",style:H({background:`${a.habit.color}20`,color:a.habit.color})},b(a.habit.emoji||"ğŸ“"),5),t("div",nt,[t("div",lt,b(a.habit.name),1),t("div",dt,[d[0]||(d[0]=T(" è¿ç»­ ",-1)),t("strong",null,b(i.value),1),d[1]||(d[1]=T(" å¤© ",-1))])])]),t("div",ct,[t("div",{class:f(["habit-checkbox",{checked:c.value}]),onClick:j(g,["stop"])},null,2)])]),t("div",rt,[d[2]||(d[2]=t("div",{class:"heatmap-preview-title"},"æœ€è¿‘8å‘¨",-1)),t("div",ut,[(r(!0),v(w,null,C(n.value,(k,S)=>(r(),v("div",{key:S,class:f(["heatmap-day",{completed:k.completed}]),title:`${k.date}: ${k.completed?"å·²å®Œæˆ":"æœªå®Œæˆ"}`},null,10,vt))),128))])])],6))}},A=x(ht,[["__scopeId","data-v-a8399d90"]]),bt={class:"modal-content"},mt={class:"modal-header"},pt={class:"form-group"},gt={class:"form-group"},yt={class:"form-group"},kt={class:"color-picker"},ft=["onClick"],_t={class:"form-actions"},$t={type:"submit",class:"btn btn-primary"},wt={__name:"HabitModal",props:{show:Boolean,editingHabit:Object},emits:["close","submit"],setup(a,{emit:l}){const s=a,e=l,c=["#10b981","#3b82f6","#8b5cf6","#f59e0b","#ef4444","#ec4899","#06b6d4","#84cc16"],i=$({name:"",emoji:"ğŸ“",color:"#10b981"});z(()=>s.editingHabit,p=>{p?i.value={name:p.name,emoji:p.emoji||"ğŸ“",color:p.color||"#10b981"}:i.value={name:"",emoji:"ğŸ“",color:"#10b981"}},{immediate:!0});const n=()=>{e("close")},g=()=>{e("submit",{...i.value}),n()};return(p,u)=>(r(),v("div",{class:f(["modal",{active:a.show}]),onClick:j(n,["self"])},[t("div",bt,[t("div",mt,[t("h2",null,b(a.editingHabit?"ç¼–è¾‘ä¹ æƒ¯":"æ·»åŠ æ–°ä¹ æƒ¯"),1),t("button",{class:"modal-close",onClick:n},"Ã—")]),t("form",{onSubmit:j(g,["prevent"])},[t("div",pt,[u[2]||(u[2]=t("label",{for:"habit-name"},"ä¹ æƒ¯åç§°",-1)),B(t("input",{type:"text",id:"habit-name","onUpdate:modelValue":u[0]||(u[0]=d=>i.value.name=d),required:"",autofocus:"",placeholder:"ä¾‹å¦‚ï¼šæ¯å¤©è·‘æ­¥"},null,512),[[V,i.value.name]])]),t("div",gt,[u[3]||(u[3]=t("label",{for:"habit-emoji"},"Emoji å›¾æ ‡",-1)),B(t("input",{type:"text",id:"habit-emoji","onUpdate:modelValue":u[1]||(u[1]=d=>i.value.emoji=d),maxlength:"2",placeholder:"ğŸ“"},null,512),[[V,i.value.emoji]])]),t("div",yt,[u[4]||(u[4]=t("label",{for:"habit-color"},"é¢œè‰²",-1)),t("div",kt,[(r(),v(w,null,C(c,d=>t("div",{key:d,class:f(["color-option",{active:i.value.color===d}]),style:H({background:d}),onClick:k=>i.value.color=d},null,14,ft)),64))])]),t("div",_t,[t("button",$t,b(a.editingHabit?"ä¿å­˜":"æ·»åŠ "),1),t("button",{type:"button",class:"btn btn-secondary",onClick:n},"å–æ¶ˆ")])],32)])],2))}},Ct=x(wt,[["__scopeId","data-v-43f6bd7c"]]),xt={class:"container"},St={class:"user-bar"},Ht={class:"user-info"},jt={class:"header"},Mt={class:"section-block"},Dt={key:0,class:"habits-container"},Tt={key:1,class:"habits-container"},Bt={key:2,class:"habits-container"},Vt={class:"section-header"},Rt={class:"section-actions"},Ft={class:"section-subtitle"},Nt={key:0,class:"habits-container archived-habits"},qt={__name:"Home",setup(a){const l=Y(),s=L(),e=G(),c=$(!1),i=$(!1),n=$(null),g=_(()=>K(e.habits));U(async()=>{try{await e.loadHabits()}catch(m){console.error("åŠ è½½ä¹ æƒ¯å¤±è´¥:",m)}});const p=async m=>{try{await e.toggleHabit(m,M())}catch(o){console.error("åˆ‡æ¢æ‰“å¡çŠ¶æ€å¤±è´¥:",o)}},u=m=>{n.value=e.habits.find(o=>o.id===m),i.value=!0},d=()=>{c.value=!1,i.value=!1,n.value=null},k=async m=>{try{n.value?await e.updateHabit(n.value.id,m):await e.addHabit(m.name,m.emoji,m.color),d()}catch(o){console.error("ä¿å­˜ä¹ æƒ¯å¤±è´¥:",o)}},S=async()=>{await s.logout(),l.push("/login")};return(m,o)=>{var D;return r(),v("div",xt,[t("div",St,[t("span",Ht," ğŸ‘¤ æ¬¢è¿ï¼Œ"+b(((D=h(s).user)==null?void 0:D.username)||"æœªç™»å½•"),1),t("button",{class:"logout-btn",onClick:S,title:"ç™»å‡º"},[...o[2]||(o[2]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),t("polyline",{points:"16 17 21 12 16 7"}),t("line",{x1:"21",y1:"12",x2:"9",y2:"12"})],-1)])])]),t("header",jt,[o[3]||(o[3]=R('<h1 data-v-4a0ed69a>ä¹ æƒ¯è¿½è¸ªå™¨</h1><div class="app-intro" data-v-4a0ed69a><p class="app-intro-text" data-v-4a0ed69a>ä¸€ä¸ªä¸“æ³¨æ‰“å¡å’Œçœ‹åˆ°è¿›æ­¥çš„æç®€ä¹ æƒ¯è®°å½•å·¥å…·ã€‚</p><div class="app-tags" data-v-4a0ed69a><span class="app-tag" data-v-4a0ed69a>ğŸ“… æ¯æ—¥æ‰“å¡</span><span class="app-tag" data-v-4a0ed69a>ğŸ“ˆ è¿ç»­å¤©æ•°</span><span class="app-tag" data-v-4a0ed69a>ğŸ”¥ 30 å¤©çƒ­åŠ›å›¾</span><span class="app-tag" data-v-4a0ed69a>â˜ï¸ äº‘ç«¯å­˜å‚¨ Â· æ•°æ®å®‰å…¨</span></div></div>',2)),F(st,{stats:g.value},null,8,["stats"])]),t("main",null,[t("section",Mt,[o[6]||(o[6]=t("div",{class:"section-header"},[t("h2",{class:"section-title"},"æ­£åœ¨è¿›è¡Œçš„ä¹ æƒ¯")],-1)),h(e).loading?(r(),v("div",Dt,[...o[4]||(o[4]=[t("div",{class:"loading"},"åŠ è½½ä¸­...",-1)])])):h(e).activeHabits.length===0?(r(),v("div",Tt,[...o[5]||(o[5]=[R('<div class="empty-state" data-v-4a0ed69a><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-4a0ed69a><circle cx="12" cy="12" r="10" data-v-4a0ed69a></circle><line x1="12" y1="8" x2="12" y2="12" data-v-4a0ed69a></line><line x1="12" y1="16" x2="12.01" y2="16" data-v-4a0ed69a></line></svg><h3 data-v-4a0ed69a>è¿˜æ²¡æœ‰ä¹ æƒ¯</h3><p data-v-4a0ed69a>ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä¹ æƒ¯</p></div>',1)])])):(r(),v("div",Bt,[(r(!0),v(w,null,C(h(e).activeHabits,y=>(r(),q(A,{key:y.id,habit:y,onToggle:p,onClick:u},null,8,["habit"]))),128))]))]),h(e).archivedHabits.length>0?(r(),v("section",{key:0,class:f(["section-block archived-section",{collapsed:h(e).archivedCollapsed}])},[t("div",Vt,[o[7]||(o[7]=t("h2",{class:"section-title"},"å·²å½’æ¡£çš„ä¹ æƒ¯",-1)),t("div",Rt,[t("span",Ft,b(h(e).archivedHabits.length)+" ä¸ª",1),t("button",{class:"section-toggle-btn",onClick:o[0]||(o[0]=(...y)=>h(e).toggleArchivedCollapsed&&h(e).toggleArchivedCollapsed(...y))},b(h(e).archivedCollapsed?"å±•å¼€":"æ”¶èµ·"),1)])]),h(e).archivedCollapsed?N("",!0):(r(),v("div",Nt,[(r(!0),v(w,null,C(h(e).archivedHabits,y=>(r(),q(A,{key:y.id,habit:y,onToggle:p,onClick:u},null,8,["habit"]))),128))]))],2)):N("",!0)]),t("button",{class:"fab",onClick:o[1]||(o[1]=y=>c.value=!0),title:"æ·»åŠ æ–°ä¹ æƒ¯"},[...o[8]||(o[8]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])]),F(Ct,{show:c.value||i.value,"editing-habit":n.value,onClose:d,onSubmit:k},null,8,["show","editing-habit"])])}}},Et=x(qt,[["__scopeId","data-v-4a0ed69a"]]);export{Et as default};
