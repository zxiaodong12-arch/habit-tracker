# 习惯追踪器 v2.0 新功能说明

## 新增功能

### 1. 习惯目标设置

#### 功能描述
为每个习惯设置完成目标，支持四种目标类型：
- **每天完成 N 次**：每天需要完成指定次数
- **每周完成 N 次**：每周需要完成指定次数
- **每月完成 N 次**：每月需要完成指定次数
- **每年完成 N 次**：每年需要完成指定次数

#### 使用方法
1. 创建或编辑习惯时，在"目标设置"区域选择目标类型
2. 输入目标完成次数
3. 保存后，系统会自动计算当前周期的完成进度

#### 进度显示
- 在习惯卡片上显示当前周期进度（如：本周 4/5 次）
- 显示进度条和剩余天数
- 在习惯详情页显示完整的目标进度信息

### 2. 习惯详情页

#### 功能描述
点击习惯卡片进入详情页，查看完整的习惯数据和分析。

#### 页面内容

**统计卡片**
- 总天数：习惯创建至今的总天数
- 完成率：已完成天数 / 总天数
- 当前连续天数
- 最长连续天数

**目标进度**
- 当前周期完成次数 / 目标次数
- 进度条可视化
- 剩余天数提示

**打卡日历（热力图）**
- 显示最近一年的打卡情况
- 颜色深浅表示完成情况
- 鼠标悬停显示具体日期和状态

**月度趋势图**
- 折线图显示每月完成次数
- 直观展示习惯完成趋势

**最近记录**
- 按日期倒序显示最近50条记录
- 显示完成状态

#### 使用方法
1. 在首页点击任意习惯卡片
2. 自动跳转到该习惯的详情页
3. 点击左上角返回按钮返回首页

## 数据库迁移

### 执行迁移
在服务器上执行以下 SQL 脚本：

```bash
mysql -u root -p habit_tracker < database_migration_v2.sql
```

或者在 MySQL 客户端中执行：

```sql
USE habit_tracker;
SOURCE database_migration_v2.sql;
```

### 新增字段
- `target_type`: 目标类型（daily/weekly/monthly/yearly）
- `target_count`: 目标完成次数
- `target_start_date`: 目标开始日期

## API 变更

### 新增接口

#### GET /api/habits/:id/detail
获取习惯详情（包含统计数据、热力图、趋势等）

**响应示例：**
```json
{
  "success": true,
  "data": {
    "habit": { ... },
    "stats": {
      "total_days": 120,
      "completed_days": 102,
      "completion_rate": 85,
      "current_streak": 15,
      "longest_streak": 30
    },
    "target_progress": {
      "target_type": "weekly",
      "target_count": 5,
      "completed": 4,
      "remaining": 1,
      "progress": 80,
      "remaining_days": 2
    },
    "heatmap": [...],
    "monthly_trend": [...],
    "recent_records": [...]
  }
}
```

### 更新接口

#### POST /api/habits
创建习惯时支持目标字段：
- `target_type`: 目标类型
- `target_count`: 目标次数
- `target_start_date`: 开始日期

#### PUT /api/habits/:id
更新习惯时支持修改目标设置

## 前端变更

### 新增组件
- `HabitDetail.vue`: 习惯详情页
- `HabitHeatmap.vue`: 日历热力图组件
- `HabitTrendChart.vue`: 月度趋势图组件

### 更新组件
- `HabitModal.vue`: 添加目标设置UI
- `HabitCard.vue`: 显示目标进度
- `Home.vue`: 点击卡片跳转到详情页

### 新增路由
- `/habit/:id`: 习惯详情页路由

## 使用建议

1. **设置合理的目标**：根据习惯的实际情况设置目标，不要设置过高导致难以完成
2. **定期查看详情页**：通过详情页了解习惯完成情况，调整策略
3. **关注连续天数**：保持连续打卡有助于习惯养成
4. **利用热力图**：通过热力图直观看到打卡情况，找出规律

## 注意事项

1. 目标进度按周期计算，周期结束后会重新开始计算
2. 热力图最多显示最近一年的数据
3. 趋势图按月统计，需要至少有一个月的记录才能显示
4. 目标设置是可选的，不设置目标时习惯卡片不显示进度
